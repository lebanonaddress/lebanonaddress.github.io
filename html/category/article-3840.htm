<!DOCTYPE html>
<html lang="zh-CN">

<head>
       <link rel="canonical" href="https://lebanonaddress.github.io/html/category/article-3840.htm" />
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="icon" href="/assets/addons/xcblog/img/lebanonaddress/favicon.ico" type="image/x-icon"/>
    <!-- site metas -->
    <title>定性检测的样本量估算之精确概率法 - Lebanon Address</title>
        <!-- bootstrap css -->
    <link rel="stylesheet" type="text/css" href="/assets/addons/xcblog/css/lebanonaddress/bootstrap.min.css">
    <!-- style css -->
    <link rel="stylesheet" type="text/css" href="/assets/addons/xcblog/css/lebanonaddress/style.css">
    <!-- Responsive-->
    <link rel="stylesheet" href="/assets/addons/xcblog/css/lebanonaddress/responsive.css">
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="/assets/addons/xcblog/css/lebanonaddress/jquery.mCustomScrollbar.min.css">
    <!-- Tweaks for older IEs-->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.0.3/css/font-awesome.css">
    <!-- fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f480db041fa3a9ffc78a7d6776ae8726";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3332997411212854"
     crossorigin="anonymous"></script>
</head>

<body>
       <!-- header section start -->
    <div class="header_section">
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="logo">
                                        <a href="/">Lebanon Address</a>
                                    </div>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ml-auto">
                                                <li class="nav-item">
                            <a class="nav-link" href="/">首页</a>
                        </li>
                                                <li class="nav-item">
                            <a class="nav-link" href="/html/category/">文章分类</a>
                        </li>
                                                <li class="nav-item">
                            <a class="nav-link" href="#">关于</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">联系</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>
    <!-- header section end -->
      <!-- services section start -->
      <div class="services_section layout_padding">
         <div class="container">
            <div class="row">
               <div class="col-sm-12">
                  <h1 class="services_taital"><span class="about_icon">定性检测的样本量估算之精确概率法 </h1>
                    <p class="nav-box text-center">
                        <a href="/">首页</a> / <a href="/html/category/">文章分类</span>
                    </p>
               </div>
            </div>
         </div>
      </div>
      <!-- services section end -->
    <!-- about sectuion start -->
    <div class="about_section layout_padding">
        <div class="container">
            <div class="row">
                <div class="col-md-9">
                      				  				  				<p>本文链接：https://www.cnblogs.com/snoopy1866/p/16069000.html</p> <p><strong>定性检测的样本量估算常用单组目标值法和抽样误差法，《体外诊断试剂临床试验技术指导原则》（2017年第72号）中提到：当评价指标P接近100%时，这两种样本量估算方法可能不适用，应考虑更加适宜的方法进行样本量估算和统计学分析，如<font color="red">精确概率法</font>。</strong></p> <h1 id="1-pass软件估计样本量">1. PASS软件估计样本量</h1> <p>PASS 软件提供的 Test for One Proportion 模块提供了精确概率法的选项，在 Power Calculation Method 中选择<strong>Binomial Enumeration</strong> 即可。SAS 软件的 PROC POWER 过程则不支持精确概率法。</p> <p>例如：某试剂的阳性符合率预期值为98%，目标值为95%，取显著性水平α=0.05，检验效能1-β=0.8，试估计所需样本量。<br /> 由于98%接近100%，因此采用精确概率法计算样本量。在 PASS 软件中设置相关参数，计算所需样本量为312。<br /><img decoding="async" src="http://img.555519.xyz/uploads3/20220510/90223594792e2c834b7af8bfcb8ceb64.jpg" alt="定性检测的样本量估算之精确概率法" width="60%"/></p> <h1 id="2-功效曲线的锯齿状现象">2. 功效曲线的"锯齿状"现象</h1> <p>需要注意的是：PASS软件通过迭代寻找满足检验效能高于0.8的样本量，当找到一个满足条件的样本量时，PASS即中止迭代，然而此时的样本量有可能并不是保守的。下面将展示这种“不保守”的现象。</p> <p>在PASS软件中，我们设定求解目标为Power，样本量取值为区间[310, 370]，绘制功效曲线如下：<br /><img decoding="async" src="http://img.555519.xyz/uploads3/20220510/c613a6a00645d72fb7a0bea79d08356e.jpg" alt="定性检测的样本量估算之精确概率法" width="50%"/><br /> 可以发现：检验效能并非随着样本量增加而单调增加，而是显示出“锯齿状”（<strong>saw-toothed</strong>），即使样本量高于PASS软件计算出的312，也存在检验效能低于0.8的情况，当且仅当样本量≥338时，才能保证检验效能稳定在0.8以上。造成此现象的原因是二项分布的离散性。</p> <h1 id="3-sas-宏程序">3. SAS 宏程序</h1> <p>以下SAS宏代码可用于计算给定参数下的精确概率法的最保守样本量，供参考。<br /> 程序的基本思路如下：<br /><strong>Step1</strong>. 使用 PROC POWER 过程的近似正态法计算一个粗略的样本量<em>n1</em><br /><strong>Step2</strong>. 在<em>n1</em> 附近找一个区间，区间上下界通过参数<em>lbound_rate</em> 和<em>ubound_rate</em> 控制<br /><strong>Step3</strong>. 使用 PROC POWER 过程计算样本量在区间 [<em>lbound_rate</em> *<em>n1</em>,<em>ubound_rate</em> *<em>n1</em>] 的检验效能<br /><strong>Step4</strong>. 判断区间 [<em>lbound_rate</em> *<em>n1</em>,<em>ubound_rate</em> *<em>n1</em>] 内是否存在满足任意 n>n0，使得 power(n) > 0.8 且 n0 之后的第一个波谷满足 power > 0.8 的 n0<br /><strong>Step5</strong>. 如 Step 4 找到了满足条件的n0，则输出样本量计算结果；否则，根据参数<em>expand_step</em> 扩展区间上界，重复 Step1-Step4</p> <pre><code class="language-sql">/* 宏程序功能：单组目标值-精确概率法，计算最保守样本量，计算结果未考虑脱落率。 */ %macro SampleSize_ExactBinomial(p0, p1, alpha = 0.05, power = 0.8, lbound_rate = 0.8, ubound_rate = 1.2, expand_step = 1,                                 OutDataSet = SampleSize_ExactBinomial, DetailInfo = DetainInfo,                                 PowerPlot = Y); /* --------------宏参数----------------- p0:             目标值 p1:             预期值 alpha:          显著性水平 power:          检验效能 lbound_rate:    寻值区间下界比例 ubound_rate:    寻值区间上界比例 expand_step:    扩展区间步长 OutDataSet:     输出样本量估算结果的数据集名称 DetailInfo:     输出样本量估算细节的数据集名称 PowerPlot:      是否绘制功效图 ----------------宏变量--------------- ntotal_normal:      正态近似法估算的样本量 ntotal_lbound:      寻值区间下界 ntotal_ubound:      寻值区间上界 IsLocalFindFirst:   是否找到首次满足检验效能的不保守样本量 IsGlobalFind:       是否找到稳定满足检验效能的最保守样本量 LooseMinSampleSize: 首次满足检验效能的不保守样本量 StrictMinSampleSize:稳定满足检验效能的最保守样本量 ActualPower:        最保守样本量下的实际检验效能 */      /*近似正态法求得一个粗略的样本量*/     ods output output = output_normal;     proc power;         onesamplefreq test = z method = normal                       alpha = &alpha                       power = &power                       nullproportion = &p0                       proportion = &p1                       ntotal = .;     run;     proc sql noprint;         select ntotal into: ntotal_normal from output_normal; /*提取正态近似样本量*/     quit;     %let ntotal_lbound = %sysfunc(floor(%sysevalf(&lbound_rate*&ntotal_normal))); /*寻值区间下界*/     %if %sysevalf(&ntotal_lbound < 5) %then %do;         %let ntotal_lbound = 1;         %let lbound_rate = %sysevalf(1/&ntotal_normal);     %end;     %let ntotal_ubound = %sysfunc(ceil(%sysevalf(&ubound_rate*&ntotal_normal))); /*寻值区间上界*/     %if %sysevalf(&ntotal_ubound < 5) %then %do;         %let ntotal_ubound = 20;         %let ubound_rate = %sysevalf(20/&ntotal_normal);     %end;       /*在区间[&ntotal_lbound, &ntotal_ubound]内多次求Power*/     ods output output = output_exact;     proc power;         onesamplefreq test = exact                       alpha = &alpha                       power = .                       nullproportion = &p0                       proportion = &p1                       ntotal = &ntotal_lbound to &ntotal_ubound by 1;         %if &PowerPlot = Y %then %do;             plot x = n min = &ntotal_lbound max = &ntotal_ubound step = 1                  yopts = (ref = &power) xopts = (ref = &ntotal_normal);         %end;     run;      /*左邻点*/     data power_exact_left;         if _n_ = 1 then do;             ntotal = &ntotal_lbound;             power_left = .;             output;         end;         set output_exact(keep = ntotal power                          rename = (power = power_left)                          firstobs = 1 obs = %eval(&ntotal_ubound - &ntotal_lbound));         ntotal = ntotal + 1;         label power_left = "左邻点";         output;     run;     /*目标点*/     data power_exact_mid;         set output_exact(keep = ntotal power rename = (power = power_mid));         label power_mid = "目标点";     run;     /*右邻点*/     data power_exact_right;         set output_exact(keep = ntotal power                          rename = (power = power_right)                          firstobs = 2 obs = %eval(&ntotal_ubound - &ntotal_lbound + 1));         ntotal = ntotal - 1;         label power_right = "右邻点";         output;         if _n_ = %eval(&ntotal_ubound - &ntotal_lbound) then do;             ntotal = &ntotal_ubound;             power_right = .;             output;         end;     run;     /*实际检验效能*/     data alpha_exact;         set output_exact(keep = ntotal alpha);     run;      /*寻找最保守的样本量*/     %let IsLocalFindFirst = 0;     %let IsGlobalFind = 0;     data &DetailInfo;         merge power_exact_left               power_exact_mid               power_exact_right               alpha_exact;         label ntotal              = "当前样本量"               power_left          = "左侧点效能"               power_mid           = "当前点效能"               power_right         = "右侧点效能"               alpha               = "实际Alpha"               min_sample_size     = "已知最低样本量"               is_local_find_first = "首次局部最优解"               is_local_find       = "局部最优解"               is_global_find      = "全局最优解"               peak                = "波峰"               trough              = "波谷";         format power_left  8.6                power_mid   8.6                power_right 8.6;         retain min_sample_size 0                is_local_find 0                is_local_find_first 0                is_global_find 0;         if ntotal > &ntotal_lbound and ntotal < &ntotal_ubound then do;             if power_left < power_mid and power_right < power_mid then peak = "Yes";             if power_left > power_mid and power_right > power_mid then trough = "Yes";              if power_mid > &power and is_local_find = 0 then do; /*局部最优解，标记到达检验效能的样本量*/                 min_sample_size = ntotal;                 is_local_find = 1;                 if is_local_find_first = 0 then do; /*首次达到局部最优解，可视为不保守的样本量估算结果*/                     is_local_find_first = 1;                     call symput("LooseMinSampleSize", min_sample_size);                     call symput("IsLocalFindFirst", is_local_find_first);                 end;             end;             if power_mid < &power and is_local_find = 1 then do; /*局部最优解的破坏，锯齿状的波谷导致此时的检验效能无法稳定在所需大小之上*/                 min_sample_size = .;                 is_local_find = 0;             end;             if (power_mid > &power and trough = "Yes" or power_mid = 1) and is_local_find = 1 and is_global_find = 0  then do; /*全局最优解，此时即便是波谷也能达到所需的检验效能，可视为最保守的样本量估算结果; 当检验效能=1时也可视为达到全局最优解*/                 is_global_find = 1;                 call symput("StrictMinSampleSize", min_sample_size);                 call symput("ActualPower", power_mid);                 call symput("IsGlobalFind", is_global_find);             end;         end;     run;          %if &IsLocalFindFirst = 1 and &IsGlobalFind = 1 %then %do;         /*输出样本量估算结果*/         data &OutDataSet;             label P0 = "目标值"                   P1 = "预期值"                   ALPHA = "显著性水平"                   POWER = "检验效能"                   Normal = "正态近似"                   Exact1 = "精确概率法（不保守）"                   Exact2 = "精确概率法（最保守）";             P0 = &p0;             P1 = &p1;             ALPHA = &alpha;             POWER = &power;             Normal = &ntotal_normal;             Exact1 = &LooseMinSampleSize;             Exact2 = &StrictMinSampleSize;         run;          /*删除数据集*/         proc delete data = output_exact                            output_normal                            power_exact_left                            power_exact_mid                            power_exact_right                            alpha_exact;         run;          /*输出日志*/         %put NOTE: 参数：&=p0, &=p1, &=alpha, &=power;         %put NOTE: 正态近似法求得最低样本量为&ntotal_normal;         %put NOTE: 精确概率法求得首次达到检验效能的最低样本量为 %sysfunc(strip(&LooseMinSampleSize)) （不保守）;         %put NOTE: 精确概率法求得最保守的样本量为 %sysfunc(strip(&StrictMinSampleSize))，实际检验效能为 %sysfunc(strip(&ActualPower));     %end;     %else %do;         %SampleSize_ExactBinomial(p0 = &p0, p1 = &p1, alpha = &alpha, power = &power, lbound_rate = &lbound_rate, ubound_rate = %sysevalf(&ubound_rate + &expand_step), expand_step = &expand_step,                                   OutDataSet = &OutDataSet, DetailInfo = &DetailInfo, PowerPlot = &PowerPlot);     %end; %mend;  /*Examples %SampleSize_ExactBinomial(p0 = 0.94, p1 = 0.98); %SampleSize_ExactBinomial(p0 = 0.94, p1 = 0.98, alpha = 0.1); %SampleSize_ExactBinomial(p0 = 0.94, p1 = 0.98, alpha = 0.1, power = 0.9); %SampleSize_ExactBinomial(p0 = 0.94, p1 = 0.98, alpha = 0.1, power = 0.9, lbound_rate = 0.8, ubound_rate = 1.3); %SampleSize_ExactBinomial(p0 = 0.94, p1 = 0.98, OutDataSet = SS); %SampleSize_ExactBinomial(p0 = 0.94, p1 = 0.98, OutDataSet = SS, DetailInfo = Info); %SampleSize_ExactBinomial(p0 = 0.94, p1 = 0.98, OutDataSet = SS, DetailInfo = Info, PowerPlot = N);    data param;     n = 1;     do p1 = 0.940 to 0.980 by 0.002;         call execute('%nrstr(%SampleSize_ExactBinomial(p0 = 0.90, p1 = '||p1||', lbound_rate = 0.6, ubound_rate = 1.2, OutDataSet = SS'||strip(put(n, best.))||', PowerPlot = N))');         n = n + 1;         output;     end; run; data SS;     set SS1-SS21; run; */</code></pre> <p>参考文献：</p> <ol> <li>Vezzoli S, CROS NT V. Evaluation of Diagnostic Agents: a SAS Macro for Sample Size Estimation Using Exact Methods[C]//SAS Conference Proceedings: Pharmaceutical Users Software Exchange. 2008: 12-15.</li> <li>Chernick M R, Liu C Y. The saw-toothed behavior of power versus sample size and software solutions: single binomial proportion using exact methods[J]. The American Statistician, 2002, 56(2): 149-155.</li> <li>AKTAŞ ALTUNAY S. Effect Size For Saw Tooth Power Function in Binomial Trials[J]. 2015.</li> </ol> 			
                    <div class="col-md-12 mt-5">
                                                <p>上一个：<a href="/html/category/article-3839.htm">VS2017的C++开发心得（一）VS的项目创建</a></p>
                                                <p>下一个：<a href="/html/category/article-3841.htm">Docker镜像构建之Dockerfile</a></p>
                                            </div>

                                    </div>
                <div class="col-md-3">
                  <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">热门文章</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2"><a href="/html/category/article-6175.htm" title="狗市吉娃娃多少钱（狗市吉娃娃视频）">狗市吉娃娃多少钱（狗市吉娃娃视频）</a></li>
                        <li class="py-2"><a href="/html/category/article-6594.htm" title="动物医疗器械市场（动物医疗设备）">动物医疗器械市场（动物医疗设备）</a></li>
                        <li class="py-2"><a href="/html/category/article-6640.htm" title="宠物粮食加工厂好做吗知乎推荐一下 宠物粮食加工厂好做吗知乎推荐一下">宠物粮食加工厂好做吗知乎推荐一下 宠物粮食加工厂好做吗知乎推荐一下</a></li>
                        <li class="py-2"><a href="/html/category/article-7147.htm" title="play是什么牌子的衣服贵吗(play是什么牌子的衣服价格)">play是什么牌子的衣服贵吗(play是什么牌子的衣服价格)</a></li>
                        <li class="py-2"><a href="/html/category/article-6641.htm" title="宠物粮食加工厂设备模具会粘吗 宠物粮食加工设备贵吗">宠物粮食加工厂设备模具会粘吗 宠物粮食加工设备贵吗</a></li>
                        <li class="py-2"><a href="/html/category/article-7146.htm" title="妙三多三联疫苗打几针（妙三多三联是什么意思）">妙三多三联疫苗打几针（妙三多三联是什么意思）</a></li>
                        <li class="py-2"><a href="/html/category/article-7008.htm" title="青岛最好的动物医院在哪里（青岛最好的动物医院在哪里啊）">青岛最好的动物医院在哪里（青岛最好的动物医院在哪里啊）</a></li>
                        <li class="py-2"><a href="/html/category/article-4576.htm" title="下一站是幸福贺繁星元宋分手（下一站幸福大结局）速看，">下一站是幸福贺繁星元宋分手（下一站幸福大结局）速看，</a></li>
                        <li class="py-2"><a href="/html/category/article-6870.htm" title="宠物医院好评文案100字 宠物店优质点评100字">宠物医院好评文案100字 宠物店优质点评100字</a></li>
                        <li class="py-2"><a href="/html/category/article-6779.htm" title="胶原蛋白肽粉哪个品牌好一点(胶原蛋白肽粉哪个品牌好一点儿)">胶原蛋白肽粉哪个品牌好一点(胶原蛋白肽粉哪个品牌好一点儿)</a></li>
                    </ul>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">归纳</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">14</span> <a href="/html/date/2024-08/" title="2024-08 归档">2024-08</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-07/" title="2024-07 归档">2024-07</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">60</span> <a href="/html/date/2024-06/" title="2024-06 归档">2024-06</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-05/" title="2024-05 归档">2024-05</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">60</span> <a href="/html/date/2024-04/" title="2024-04 归档">2024-04</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-03/" title="2024-03 归档">2024-03</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">44</span> <a href="/html/date/2024-02/" title="2024-02 归档">2024-02</a></h4>
            </li>
                    </ul>
    </div>
</div>



               </div>
            </div>
        </div>
    </div>
    <!-- about sectuion end -->
        <!-- copyright section start -->
    <div class="copyright_section">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <p class="copyright_text">
                        Lebanon Address 版权所有
                        <br />
                        Powered by WordPress
                    </p>
                </div>
            </div>
        </div>
    </div>
    <!-- copyright section end -->
    <!-- Javascript files-->
    <script src="/assets/addons/xcblog/js/frontend/lebanonaddress/jquery.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/lebanonaddress/popper.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/lebanonaddress/bootstrap.bundle.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/lebanonaddress/jquery-3.0.0.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/lebanonaddress/plugin.js"></script>
    <script>
    $(function() {
        $('.js_to').click(function(){
            var url = $(this).data('url');
            var code = $(this).data('code');
            url += code;

            window.open(url);
        })
    });
    </script>
</body>

</html>